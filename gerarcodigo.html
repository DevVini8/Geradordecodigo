<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="icon" href="img/pngwing.com (1).png" type="image/x-icon">
    <link href="css/gerarcodigo.css" type="text/css" rel="stylesheet">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Geração de Código por CPF</title>
    <style>
       
        
       body {
    font-family: Arial, sans-serif;
    background-color: #f0f5ff;
    margin: 0;
    padding: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background-image: url(img/logo.png);
    background-repeat: no-repeat;
    background-position: center calc(30% - 90px);
    background-size: auto; /* Ajuste o valor de background-size conforme necessário */
    color: #007bff;
}

    </style>
</head>
<body>

    <div class="codigo-container">
        <h2>Geração de Código por CPF</h2>
        <label for="cpf">Informe o CPF:</label>
        <input type="text" id="cpf" placeholder="123.456.789-00" maxlength="14" oninput="formatarCPF(this)">
        <button onclick="gerarCodigo()">Gerar Código</button>
        <div id="resultado"></div>
        <button onclick="imprimirCodigos()">Imprimir Códigos</button>

        <!-- Adicione a interface de seleção de CPF para exclusão -->
        <div>

        </div>

        <div class="excluir">
            <button onclick="excluirTodos()">Excluir Tudo</button>
        </div>

        <div id="codigosAnteriores"></div>
    </div>

    <script>
        function formatarCPF(input) {
            // Formatar o CPF para o formato ###.###.###-##
            var valor = input.value.replace(/\D/g, '');
            if (valor.length > 9) {
                input.value = valor.replace(/^(\d{3})(\d{3})(\d{3})(\d{2})$/, '$1.$2.$3-$4');
            } else if (valor.length > 6) {
                input.value = valor.replace(/^(\d{3})(\d{3})(\d{3})$/, '$1.$2.$3');
            } else if (valor.length > 3) {
                input.value = valor.replace(/^(\d{3})(\d{3})$/, '$1.$2');
            } else {
                input.value = valor;
            }
        }

        function gerarCodigo() {
            var cpf = document.getElementById("cpf").value.replace(/\D/g, '');

            if (cpf.length !== 11) {
                alert("Informe um CPF válido.");
                return;
            }

            // Verificar se o CPF já existe na lista
            var codigosAnteriores = JSON.parse(localStorage.getItem('codigosAnteriores')) || [];
            var cpfExistente = codigosAnteriores.find(function (item) {
                return item.cpf === cpf;
            });

            if (cpfExistente) {
                alert("CPF já existente na lista.");
                return;
            }

            // Lógica de geração do código de 4 dígitos
            var codigo = Math.floor(Math.random() * 10000).toString().padStart(4, '0');

            // Exibir o resultado na página
            document.getElementById("resultado").innerHTML = "<p>Código gerado para o CPF " + cpf + ": <strong>" + codigo + "</strong></p>";

            // Gravar CPF e código no armazenamento local
            salvarCodigoAnterior(cpf, codigo);
        }

        function salvarCodigoAnterior(cpf, codigo) {
            var codigosAnteriores = JSON.parse(localStorage.getItem('codigosAnteriores')) || [];
            codigosAnteriores.push({ cpf: cpf, codigo: codigo });
            localStorage.setItem('codigosAnteriores', JSON.stringify(codigosAnteriores));

            // Atualizar a exibição dos códigos anteriores
            exibirCodigosAnteriores();
            // Atualizar a lista de CPFs para exclusão
            atualizarListaCpfs();
        }

        function exibirCodigosAnteriores() {
            var codigosAnteriores = JSON.parse(localStorage.getItem('codigosAnteriores')) || [];
            var codigosAnterioresHTML = "<h3>Códigos Anteriores</h3>";

            codigosAnteriores.forEach(function (item) {
                codigosAnterioresHTML += "<p>CPF: " + item.cpf + " | Código: " + item.codigo +
                    " <button class='excluir-btn' onclick='excluirCodigoSelecionado(\"" + item.cpf + "\")'>Excluir</button></p>";
            });

            document.getElementById("codigosAnteriores").innerHTML = codigosAnterioresHTML;
        }

        function atualizarListaCpfs() {
            var codigosAnteriores = JSON.parse(localStorage.getItem('codigosAnteriores')) || [];
            var listaCpfsHTML = "<option value=''>Selecione um CPF</option>";

            codigosAnteriores.forEach(function (item) {
                listaCpfsHTML += "<option value='" + item.cpf + "'>" + item.cpf + "</option>";
            });

            document.getElementById("selecionarCpf").innerHTML = listaCpfsHTML;
        }

        function excluirCodigoSelecionado(cpfSelecionado) {
            if (cpfSelecionado) {
                var codigosAnteriores = JSON.parse(localStorage.getItem('codigosAnteriores')) || [];
                var novosCodigos = codigosAnteriores.filter(function (item) {
                    return item.cpf !== cpfSelecionado;
                });

                localStorage.setItem('codigosAnteriores', JSON.stringify(novosCodigos));
                exibirCodigosAnteriores();
                atualizarListaCpfs();
            }
        }

        function excluirTodos() {
            localStorage.removeItem('codigosAnteriores');
            exibirCodigosAnteriores();
            atualizarListaCpfs();
        }

        function imprimirCodigos() {
            var conteudoImprimir = document.getElementById("codigosAnteriores").innerHTML;

            var janelaImprimir = window.open('', '', 'width=600,height=600');
            janelaImprimir.document.write('<html><head><title>Imprimir Códigos Anteriores</title></head><body>');
            janelaImprimir.document.write('<h1>Códigos Anteriores</h1>');
            janelaImprimir.document.write(conteudoImprimir);
            janelaImprimir.document.write('</body></html>');
            janelaImprimir.document.close();
            janelaImprimir.print();
        }

        // Exibir códigos anteriores ao carregar a página
        exibirCodigosAnteriores();
        // Inicializar a lista de CPFs para exclusão
        atualizarListaCpfs();
    </script>

</body>
</html>
